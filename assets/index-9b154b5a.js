import{i as n,e as b,o as A,C as I,l as o,w as i,k as t,F as O,D as W,n as p,x as N,m as S,G as E,h as T,H as J}from"./index-5554b66c.js";import{N as V,a as d,b as q}from"./DataTable-538acb6b.js";import{a as g,N as R}from"./FormItem-729e50bf.js";import"./Checkbox-9d428ad2.js";const X=Object.assign({name:"CostIndicators"},{__name:"index",setup(G){const j=n(null),C=n("medium"),l=n({selectValueProjectName:"广州粤芯半导体技术有限公司12英寸集成电路生产线项目总承包",selectValueProjectNames:["京东方B17项目180K扩产设计项目"],selectValueFilter1:"栋号名称",selectValueFilter2:"专业名称",selectValueLv1:"",selectValueLv2:"",selectValueItemLv1:"",selectValueItemLv2:"",selectValueBuildingCategory:"",selectValueBuildingName:"",selectValuePackageName:"",selectValueFilterName1:"",selectValueFilterName2:"",selectValueFloorage:"建筑面积"}),P=b(()=>"分类1:"+(l.value.selectValueFilter1||"请先选择分类1")),x=b(()=>"分类2:"+(l.value.selectValueFilter2||"请先选择分类2")),z={selectValueProjectName:[{required:!0,trigger:["blur","change"],message:"请选择至少一个项目",validator:(e,a)=>(console.log("触发验证ProjectName",a),a.length==0?(console.log("触发验证ProjectName",a),new Error("需要选择至少一个项目")):!0)}]},r=n({filter1:["栋号名称","包名称","专业名称","一级系统","二级系统","一级物料","二级物料"].map(e=>({label:e,value:e})),filter2:["栋号名称","包名称","专业名称","一级系统","二级系统","一级物料","二级物料"].map(e=>({label:e,value:e})),floorageNames:["建筑面积","洁净面积","核心面积","精装面积","普装面积"].map(e=>({label:e,value:e}))}),_=b(()=>{let e=r.value.buildingNames;switch(console.log("当前分类1选择的是：",l.value.selectValueFilter1),l.value.selectValueFilter1){case"栋号名称":e=r.value.buildingNames;break;case"包名称":e=r.value.packageNames;break;case"专业名称":e=r.value.majorNames;break;case"一级系统":e=r.value.lv1;break;case"二级系统":e=r.value.lv2;break;case"一级物料":e=r.value.itemLv1;break;case"二级物料":e=r.value.itemLv2;break}return e}),L=b(()=>{let e=r.value.buildingNames;switch(console.log("当前分类2选择的是：",l.value.selectValueFilter2),l.value.selectValueFilter2){case"栋号名称":e=r.value.buildingNames;break;case"包名称":e=r.value.packageNames;break;case"专业名称":e=r.value.majorNames;break;case"一级系统":e=r.value.lv1;break;case"二级系统":e=r.value.lv2;break;case"一级物料":e=r.value.itemLv1;break;case"二级物料":e=r.value.itemLv2;break}return e});n([{label:"在这里选择要查询的项目的名称",value:"",disabled:!0}]);const m=({node:e,option:a})=>T(J,{placement:"right"},{trigger:()=>e,default:()=>a.label}),w=()=>{var e=[];return e};let f=n(0),F=n(0);const h=n(w()),c=n({page:1,pageSize:15,showSizePicker:!0,pageSizes:[15,30,50],prefix({itemCount:e}){return`共计 ${e}条数据`},onUpdatePageSize:e=>{c.value.pageSize=e,c.value.page=1}}),v=new Intl.NumberFormat("en-US"),B=[{title:"分类1",key:"filter1",minWidth:60,titleAlign:"center"},{title:"分类2",key:"filter2",minWidth:60,titleAlign:"center"},{title:"分包合同总价（元）",key:"totalCost",minWidth:60,titleAlign:"center",align:"right",render:e=>v.format(e.totalCost)},{title(){return l.value.selectValueFloorage},key:l.value.selectValueFloorage,minWidth:60,titleAlign:"center",align:"right",render:e=>v.format(e[l.value.selectValueFloorage])},{title:"分包合同总金额（元）",key:"totalCost",minWidth:60,titleAlign:"center",align:"right",render:e=>v.format(e.totalCost)},{title:"造价占比（%）",key:"costPercent",minWidth:100,titleAlign:"center",align:"right",render:e=>(e.totalCost/f.value*100).toFixed(2)+"%"},{title:"单方造价（元/m2）",key:"costIndicator",minWidth:100,titleAlign:"center",align:"right",render:e=>v.format((e.totalCost/e[l.value.selectValueFloorage]).toFixed(2))}];async function k(e){const a=await W.post("/DataTools/CostIndicators",{projectName:l.value.selectValueProjectName||"",buildingCategory:l.value.selectValueBuildingCategory||"",filter1:l.value.selectValueFilter1||"",filter2:l.value.selectValueFilter2||"",filterName1:l.value.selectValueFilterName1||"",filterName2:l.value.selectValueFilterName2||"",page:e,pageSize:c.value.pageSize});c.value.itemCount=a.total,c.value.page=a.page,c.value.pageSize=a.pageSize,c.value.pageCount=a.pageCount,console.log("res data is",a),console.log("当前返回数据是：",JSON.parse(a.data));let u=JSON.parse(a.data);h.value=[],f.value=a.total_price_sum,F.value=a.total_floorage_sum,console.log("当前选择的面积类型是：",l.value.selectValueFloorage),u.forEach(s=>{h.value.push({filter1:s[l.value.selectValueFilter1],filter2:s[l.value.selectValueFilter2],totalCost:s.合价.toFixed(2),建筑面积:s.建筑面积,占地面积:s.占地面积,洁净面积:s.洁净面积,核心面积:s.核心面积,精装面积:s.精装面积,普装面积:s.普装面积})}),["projectNames","lv1","lv2","itemLv1","itemLv2","majorNames","packageNames","buildingNames","buildingCategory"].forEach(s=>{r.value[s]=[],JSON.parse(a[s]).forEach(y=>{y&&r.value[s].push({label:y,value:y})})})}k(1);async function U(){k(1)}async function D(e){k(e)}return(e,a)=>(A(),I(O,null,[o(t(E),{justify:"space-between",align:"center"},{default:i(()=>[o(t(V),{type:"info"},{default:i(()=>[p(N(l.value.selectValueProjectName?l.value.selectValueProjectName:"这里仅用于显示当前项目名称"),1)]),_:1}),o(t(S),{bordered:!1},{default:i(()=>[o(t(V),{bordered:!1,type:"success"},{default:i(()=>[p(" 总价:"+N(t(v).format((t(f)/1e4).toFixed(2)))+"（万元） ",1)]),_:1}),o(t(V),{bordered:!1,type:"success"},{default:i(()=>[p(" 总面积:"+N(t(v).format(t(F).toFixed(2)))+"（m2） ",1)]),_:1}),o(t(V),{bordered:!1,type:"info"},{default:i(()=>[p(" 单平米指标:"+N(t(v).format((t(f)/t(F)).toFixed(2)))+"（元/m2） ",1)]),_:1})]),_:1})]),_:1}),o(t(R),{inline:"",ref_key:"formRef",ref:j,model:l.value,rules:z,"label-width":"auto","require-mark-placement":"right-hanging",size:C.value},{default:i(()=>[o(t(g),{label:"项目名称",path:"selectValueProjectName"},{default:i(()=>[o(t(d),{filterable:"",value:l.value.selectValueProjectName,"onUpdate:value":a[0]||(a[0]=u=>l.value.selectValueProjectName=u),placeholder:"Select",options:r.value.projectNames,"render-option":m},null,8,["value","options"])]),_:1}),o(t(g),{label:"栋号分类",path:"selectValueBuildingCategory"},{default:i(()=>[o(t(d),{filterable:"",value:l.value.selectValueBuildingCategory,"onUpdate:value":a[1]||(a[1]=u=>l.value.selectValueBuildingCategory=u),placeholder:"Select",options:r.value.buildingCategory,"render-option":m,clearable:""},null,8,["value","options"])]),_:1}),o(t(g),{label:"分类1",path:"selectValueFilter1"},{default:i(()=>[o(t(d),{filterable:"",value:l.value.selectValueFilter1,"onUpdate:value":a[2]||(a[2]=u=>l.value.selectValueFilter1=u),placeholder:"Select",options:r.value.filter1,"render-option":m},null,8,["value","options"])]),_:1}),o(t(g),{label:P.value,path:"selectValueFilterName1"},{default:i(()=>[o(t(d),{filterable:"",value:l.value.selectValueFilterName1,"onUpdate:value":a[3]||(a[3]=u=>l.value.selectValueFilterName1=u),placeholder:"Select",options:_.value,"render-option":m,clearable:""},null,8,["value","options"])]),_:1},8,["label"]),o(t(g),{label:"面积",path:"selectValueFloorage"},{default:i(()=>[o(t(d),{filterable:"",value:l.value.selectValueFloorage,"onUpdate:value":a[4]||(a[4]=u=>l.value.selectValueFloorage=u),placeholder:"Select",options:r.value.floorageNames,"render-option":m},null,8,["value","options"])]),_:1}),o(t(g),{label:"分类2",path:"selectValueFilter2"},{default:i(()=>[o(t(d),{filterable:"",value:l.value.selectValueFilter2,"onUpdate:value":a[5]||(a[5]=u=>l.value.selectValueFilter2=u),placeholder:"Select",options:r.value.filter2,"render-option":m,clearable:""},null,8,["value","options"])]),_:1}),o(t(g),{label:x.value,path:"selectValueFilterName2"},{default:i(()=>[o(t(d),{filterable:"",value:l.value.selectValueFilterName2,"onUpdate:value":a[6]||(a[6]=u=>l.value.selectValueFilterName2=u),placeholder:"Select",options:L.value,"render-option":m,clearable:""},null,8,["value","options"]),o(t(S),{disabled:l.value.selectValueProjectName.length==0,type:"primary",onClick:U},{default:i(()=>[p(" 搜索 ")]),_:1},8,["disabled"])]),_:1},8,["label"])]),_:1},8,["model","size"]),o(t(q),{remote:"",ref:"table",columns:B,data:h.value,pagination:c.value,size:C.value,"single-line":!1,"onUpdate:page":D,"max-height":"400"},null,8,["data","pagination","size"])],64))}});export{X as default};
