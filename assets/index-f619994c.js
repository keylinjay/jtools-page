import{r as n,f as N,o as I,j as O,w as o,k as a,D as T,l as r,n as g,y as b,m as S,v as j,t as E,A as J,h as q,F as R}from"./index-b63eef77.js";import{N as V,a as p,b as A}from"./DataTable-b9c5313b.js";import{N as H,a as d}from"./FormItem-9113f445.js";import{N as K}from"./LayoutContent-a3968ff6.js";const Z={__name:"index",setup($){const _=n(null),C=n("medium"),l=n({selectValueProjectName:"广州粤芯半导体技术有限公司12英寸集成电路生产线项目总承包",selectValueProjectNames:["京东方B17项目180K扩产设计项目"],selectValueFilter1:"栋号名称",selectValueFilter2:"专业名称",selectValueLv1:"",selectValueLv2:"",selectValueItemLv1:"",selectValueItemLv2:"",selectValueBuildingCategory:"",selectValueBuildingName:"",selectValuePackageName:"",selectValueFilterName1:"",selectValueFilterName2:"",selectValueFloorage:"建筑面积"}),P=N(()=>"分类1:"+(l.value.selectValueFilter1||"请先选择分类1")),L=N(()=>"分类2:"+(l.value.selectValueFilter2||"请先选择分类2")),z={selectValueProjectName:[{required:!0,trigger:["blur","change"],message:"请选择至少一个项目",validator:(e,t)=>(console.log("触发验证ProjectName",t),t.length==0?(console.log("触发验证ProjectName",t),new Error("需要选择至少一个项目")):!0)}]},u=n({filter1:["栋号名称","包名称","专业名称","一级系统","二级系统","一级物料","二级物料"].map(e=>({label:e,value:e})),filter2:["栋号名称","包名称","专业名称","一级系统","二级系统","一级物料","二级物料"].map(e=>({label:e,value:e})),floorageNames:["建筑面积","洁净面积","核心面积","精装面积","普装面积"].map(e=>({label:e,value:e}))}),x=N(()=>{let e=u.value.buildingNames;switch(console.log("当前分类1选择的是：",l.value.selectValueFilter1),l.value.selectValueFilter1){case"栋号名称":e=u.value.buildingNames;break;case"包名称":e=u.value.packageNames;break;case"专业名称":e=u.value.majorNames;break;case"一级系统":e=u.value.lv1;break;case"二级系统":e=u.value.lv2;break;case"一级物料":e=u.value.itemLv1;break;case"二级物料":e=u.value.itemLv2;break}return e}),w=N(()=>{let e=u.value.buildingNames;switch(console.log("当前分类2选择的是：",l.value.selectValueFilter2),l.value.selectValueFilter2){case"栋号名称":e=u.value.buildingNames;break;case"包名称":e=u.value.packageNames;break;case"专业名称":e=u.value.majorNames;break;case"一级系统":e=u.value.lv1;break;case"二级系统":e=u.value.lv2;break;case"一级物料":e=u.value.itemLv1;break;case"二级物料":e=u.value.itemLv2;break}return e});n([{label:"在这里选择要查询的项目的名称",value:"",disabled:!0}]);const m=({node:e,option:t})=>q(R,{placement:"right"},{trigger:()=>e,default:()=>t.label}),B=()=>{var e=[];return e};let f=n(0),F=n(0);const h=n(B()),c=n({page:1,pageSize:15,showSizePicker:!0,pageSizes:[15,30,50],prefix({itemCount:e}){return`共计 ${e}条数据`},onUpdatePageSize:e=>{c.value.pageSize=e,c.value.page=1}}),v=new Intl.NumberFormat("en-US"),U=[{title:"分类1",key:"filter1",minWidth:60},{title:"分类2",key:"filter2",minWidth:60},{title:"分包合同总价（元）",key:"totalCost",minWidth:60,align:"right",render:e=>v.format(e.totalCost)},{title(){return l.value.selectValueFloorage},key:l.value.selectValueFloorage,minWidth:60,align:"right",render:e=>v.format(e[l.value.selectValueFloorage])},{title:"分包合同总金额（元）",key:"totalCost",minWidth:60,align:"right",render:e=>v.format(e.totalCost)},{title:"造价占比（%）",key:"costPercent",minWidth:100,align:"right",render:e=>(e.totalCost/f.value*100).toFixed(2)+"%"},{title:"单方造价（元/m2）",key:"costIndicator",minWidth:100,align:"right",render:e=>v.format((e.totalCost/e[l.value.selectValueFloorage]).toFixed(2))}];async function k(e){const t=await T.post("/DataTools/CostIndicators",{projectName:l.value.selectValueProjectName||"",buildingCategory:l.value.selectValueBuildingCategory||"",filter1:l.value.selectValueFilter1||"",filter2:l.value.selectValueFilter2||"",filterName1:l.value.selectValueFilterName1||"",filterName2:l.value.selectValueFilterName2||"",page:e,pageSize:c.value.pageSize});c.value.itemCount=t.total,c.value.page=t.page,c.value.pageSize=t.pageSize,c.value.pageCount=t.pageCount,console.log("res data is",t),console.log("当前返回数据是：",JSON.parse(t.data));let s=JSON.parse(t.data);h.value=[],f.value=t.total_price_sum,F.value=t.total_floorage_sum,console.log("当前选择的面积类型是：",l.value.selectValueFloorage),s.forEach(i=>{h.value.push({filter1:i[l.value.selectValueFilter1],filter2:i[l.value.selectValueFilter2],totalCost:i.合价.toFixed(2),建筑面积:i.建筑面积,占地面积:i.占地面积,洁净面积:i.洁净面积,核心面积:i.核心面积,精装面积:i.精装面积,普装面积:i.普装面积})}),["projectNames","lv1","lv2","itemLv1","itemLv2","majorNames","packageNames","buildingNames","buildingCategory"].forEach(i=>{u.value[i]=[],JSON.parse(t[i]).forEach(y=>{y&&u.value[i].push({label:y,value:y})})})}k(1);async function D(){k(1)}async function W(e){k(e)}return(e,t)=>(I(),O(a(J),null,{default:o(()=>[r(a(j),{justify:"space-between",align:"center"},{default:o(()=>[r(a(V),{type:"info"},{default:o(()=>[g(b(l.value.selectValueProjectName?l.value.selectValueProjectName:"这里仅用于显示当前项目名称"),1)]),_:1}),r(a(S),{bordered:!1},{default:o(()=>[r(a(V),{bordered:!1,type:"success"},{default:o(()=>[g(" 总价:"+b(a(v).format((a(f)/1e4).toFixed(2)))+"（万元） ",1)]),_:1}),r(a(V),{bordered:!1,type:"success"},{default:o(()=>[g(" 总面积:"+b(a(v).format(a(F).toFixed(2)))+"（m2） ",1)]),_:1}),r(a(V),{bordered:!1,type:"info"},{default:o(()=>[g(" 单平米指标:"+b(a(v).format((a(f)/a(F)).toFixed(2)))+"（元/m2） ",1)]),_:1})]),_:1})]),_:1}),r(a(E),null,{default:o(()=>[r(a(j),{style:{padding:"12px"}},{default:o(()=>[r(a(H),{inline:"",ref_key:"formRef",ref:_,model:l.value,rules:z,"label-width":e.auto,"require-mark-placement":"right-hanging",size:C.value},{default:o(()=>[r(a(d),{label:"项目名称",path:"selectValueProjectName"},{default:o(()=>[r(a(p),{filterable:"",value:l.value.selectValueProjectName,"onUpdate:value":t[0]||(t[0]=s=>l.value.selectValueProjectName=s),placeholder:"Select",options:u.value.projectNames,"render-option":m},null,8,["value","options"])]),_:1}),r(a(d),{label:"栋号分类",path:"selectValueBuildingCategory"},{default:o(()=>[r(a(p),{filterable:"",value:l.value.selectValueBuildingCategory,"onUpdate:value":t[1]||(t[1]=s=>l.value.selectValueBuildingCategory=s),placeholder:"Select",options:u.value.buildingCategory,"render-option":m,clearable:""},null,8,["value","options"])]),_:1}),r(a(d),{label:"分类1",path:"selectValueFilter1"},{default:o(()=>[r(a(p),{filterable:"",value:l.value.selectValueFilter1,"onUpdate:value":t[2]||(t[2]=s=>l.value.selectValueFilter1=s),placeholder:"Select",options:u.value.filter1,"render-option":m},null,8,["value","options"])]),_:1}),r(a(d),{label:P.value,path:"selectValueFilterName1"},{default:o(()=>[r(a(p),{filterable:"",value:l.value.selectValueFilterName1,"onUpdate:value":t[3]||(t[3]=s=>l.value.selectValueFilterName1=s),placeholder:"Select",options:x.value,"render-option":m,clearable:""},null,8,["value","options"])]),_:1},8,["label"]),r(a(d),{label:"面积",path:"selectValueFloorage"},{default:o(()=>[r(a(p),{filterable:"",value:l.value.selectValueFloorage,"onUpdate:value":t[4]||(t[4]=s=>l.value.selectValueFloorage=s),placeholder:"Select",options:u.value.floorageNames,"render-option":m},null,8,["value","options"])]),_:1}),r(a(d),{label:"分类2",path:"selectValueFilter2"},{default:o(()=>[r(a(p),{filterable:"",value:l.value.selectValueFilter2,"onUpdate:value":t[5]||(t[5]=s=>l.value.selectValueFilter2=s),placeholder:"Select",options:u.value.filter2,"render-option":m,clearable:""},null,8,["value","options"])]),_:1}),r(a(d),{label:L.value,path:"selectValueFilterName2"},{default:o(()=>[r(a(p),{filterable:"",value:l.value.selectValueFilterName2,"onUpdate:value":t[6]||(t[6]=s=>l.value.selectValueFilterName2=s),placeholder:"Select",options:w.value,"render-option":m,clearable:""},null,8,["value","options"])]),_:1},8,["label"]),r(a(d),null,{default:o(()=>[r(a(S),{disabled:l.value.selectValueProjectName.length==0,type:"primary",onClick:D},{default:o(()=>[g(" 搜索 ")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model","label-width","size"])]),_:1})]),_:1}),r(a(K),{"native-scrollbar":!1},{default:o(()=>[r(a(A),{remote:"",ref:"table",columns:U,data:h.value,pagination:c.value,size:C.value,"single-line":!1,"onUpdate:page":W,"max-height":"400"},null,8,["data","pagination","size"])]),_:1})]),_:1}))}};export{Z as default};
